# GESP AI — 智能编程备考助手

AI 驱动的 GESP C++ 编程等级考试备考平台，面向小学/初中生，集知识点学习、在线刷题、错题诊断、模拟考试于一体。

---

## 产品概述

**目标用户：** 备考 GESP C++ 4-6 级的小学生和初中生

**核心理念：** 以 AI 为核心驱动力，通过个性化辅导、即时反馈和游戏化激励，让学生高效备考。

**提示词优先级链：** 用户自定义 > 管理员数据库设置 > 硬编码默认值

---

## 核心功能模块

### 1. 学习规划系统

#### 1.1 学习目标设置（`/setup`）
- 三步向导：选择目标级别（4/5/6 级）→ 设置考试日期 → 安排每周学习时间
- 展示 2026 年 GESP 考试时间表供参考
- AI 根据用户情况自动生成个性化周计划

#### 1.2 每日任务（首页 `/`）
- 根据学习计划自动生成每日任务（知识点学习 + 编程练习）
- 任务进度条与 XP 奖励追踪
- 考前冲刺模式（距离考试 ≤7 天自动激活）
- 完成全部任务触发庆祝动画

---

### 2. 知识点学习

#### 2.1 知识点地图（`/map`）
- 按 GESP 官方考纲展示 4/5/6 级知识点体系
- 按分类分组：基础语法、数据结构、算法、数学
- 每个知识点卡片显示掌握度百分比、学习状态（私教完成/费曼完成/练习准确率）

#### 2.2 AI 私教模式（`/learn/[topic]/tutor`）
- AI 以亲切的编程老师身份进行交互式教学
- 支持语音输入提问（讯飞实时语音识别）
- 流式响应逐字显示 AI 回复
- 完成学习后获得 XP 奖励

#### 2.3 费曼学习法（`/learn/[topic]/feynman`）
- 学生向 AI "讲解"知识点，AI 以学生身份追问
- 通过反向提问检验理解深度
- 结束时 AI 给出多维评估：完整度、准确度、清晰度、薄弱点
- 支持语音输入

---

### 3. 在线刷题系统

#### 3.1 题库浏览（`/problem`）
- 默认按用户目标级别筛选题目
- 支持按级别（4/5/6 级）、难度（入门～NOI）、关键词筛选
- 题目卡片显示解题状态（已通过 / 尝试过 / 未做）、知识点标签

#### 3.2 在线编程与评测（`/problem/[id]`）
- **左侧面板**（Tab 切换）：
  - 题目描述（Markdown 渲染，含输入输出格式和样例）
  - AI 辅导对话（讨论解题思路）
  - 提交前自检清单（7 项：格式、初始化、越界、除零、溢出、复杂度、边界）
  - 评测结果详情（测试点对比、时间/内存）
- **右侧面板**：Monaco Editor（C++ 语法高亮）
- **评测流程**：提交代码 → 防错规则检查 → Judge0 在线判题 → 返回结果
- **AI 调试助手**：评测失败时可请求 AI 帮助，提供三级渐进式提示：
  - 第 1 次：轻提示（引导观察差异）
  - 第 2 次：中等提示（定位具体问题）
  - 第 3 次+：详细提示（给出修改建议和关键代码片段）
- **错题记录**：评测失败时可一键记录到错题本

---

### 4. 错题诊断系统

#### 4.1 错题本（`/error-book`）
- 统计概览：总错题数、待复盘、复盘中、已完成
- 薄弱点分析：高频错误组合（同一知识点 + 错误类型 ≥2 次）
- 错误类型分布可视化
- 按状态和错误类型筛选

#### 4.2 错误分类（10 种类型）
| 阶段 | 类型 | 标签 | 说明 |
|------|------|------|------|
| CE | syntax | 语法错误 | 代码无法编译 |
| RE | runtime | 运行崩溃 | 程序运行中途崩溃 |
| TLE | timeout | 效率不足 | 算法复杂度过高 |
| WA | misread | 审题疏漏 | 没看清题目条件 |
| WA | boundary | 边界遗漏 | 未处理特殊情况 |
| WA | careless | 粗心笔误 | 思路对但手误 |
| WA | uninit | 未初始化 | 变量未赋初值 |
| WA | logic | 逻辑错误 | 实现细节有漏洞 |
| WA | algorithm | 思路错误 | 算法方法本身错误 |
| WA | overflow | 数值溢出 | 整数范围超限 |

#### 4.3 三问复盘法（`/error-book/[id]`）
- AI 自动分析错误类型并归类
- 引导学生完成三个问题：
  1. **错了哪？** — 定位问题所在
  2. **为什么错？** — 分析根本原因
  3. **怎么避免？** — 总结防错策略
- 每个问题可获取 AI 引导提示
- 完成三问后自动生成防错规则

#### 4.4 防错规则库（`/error-book/rules`）
- 从三问复盘自动生成简短可执行的防错规则
- 规则管理：启用/禁用/删除
- 触发统计：记录每条规则的命中次数
- **提交前检查**：代码提交前 AI 自动检查是否违反已有规则，给出预警

---

### 5. 模拟考试（`/mock-exam`）

- 模拟真实 GESP 考试环境（90 分钟，选择题 30 分 + 编程题 70 分）
- 预估通过率（基于 XP 和历史成绩计算）
- 考试记录：得分、通过/失败、题型得分、用时
- 考前冲刺模式：距离考试 ≤7 天时特殊提醒

---

### 6. 用户个性化配置

#### 6.1 个人中心（`/profile`）
- 学习统计：已解题数、提交次数、学习时长、最长连胜
- 徽章墙：7 种成就徽章（已解锁/未解锁）
- GESP 各级别知识点掌握度

#### 6.2 AI 提示词自定义（`/profile/ai-config`）
- 用户可自定义 4 种核心场景的 AI 提示词：
  - AI 私教、题目辅导、调试助手、费曼学习
- 支持恢复默认值
- 自定义提示词优先于系统默认

---

### 7. 管理后台

#### 7.1 题库管理（`/admin/problems`）
- 从洛谷同步 GESP 官方题目（4/5/6 级）
- 操作：检查状态、同步缺失题目、全部重建
- 实时显示同步进度和结果

#### 7.2 数据导入（`/admin/import`）
- 通过浏览器脚本从洛谷批量获取题目数据
- JSON 粘贴导入，显示导入结果统计

#### 7.3 提示词管理（`/admin/prompts`）
- 集中管理系统中 15 个 AI 提示词
- 按分类浏览：核心对话（4 个）、错题诊断（6 个）、工具类（5 个）
- 在线编辑提示词内容
- 对比默认值（当前值 vs 硬编码值并排对比）
- 一键恢复默认
- 初始化按钮：将硬编码提示词批量写入数据库

---

### 8. 数据导入（`/import`）

- **洛谷数据导入**：输入洛谷主页链接，自动解析 AC/WA 题目记录
- **代码分析导入**：粘贴 C++ 代码，AI 评估编程水平并推荐起始级别

---

### 9. 游戏化激励体系

| 机制 | 说明 |
|------|------|
| XP 经验值 | 完成学习 +20 XP，解题通过按难度奖励，完成每日任务额外奖励 |
| 连胜系统 | 每日完成全部任务 +1 天，超过 1 天未活动则重置 |
| 成就徽章 | 7 种可获得徽章，根据学习成就自动解锁 |
| 进度追踪 | 知识点掌握度 0-100%，综合学习/费曼/练习三维度 |

---

## 技术架构

| 层 | 技术 |
|----|------|
| 前端框架 | Next.js 14（App Router） |
| UI 组件 | shadcn/ui + Tailwind CSS |
| 代码编辑器 | Monaco Editor |
| 状态管理 | React Hooks |
| 认证 | NextAuth.js（JWT + Credentials） |
| 数据库 | PostgreSQL + Prisma ORM |
| AI 引擎 | Claude API（Anthropic） |
| 代码评测 | Judge0 API |
| 语音输入 | 讯飞实时语音听写 API |
| 部署 | Railway |

---

## 数据模型

| 模型 | 说明 |
|------|------|
| User | 用户信息、学习目标、AI 配置、统计数据 |
| Problem | 题目（来源、级别、难度、描述、测试用例） |
| Submission | 代码提交（评测结果、AI 调试记录） |
| KnowledgePoint | 知识点树形结构 |
| LearningRecord | 学习进度（私教/费曼/练习） |
| StudyPlan | 学习计划 |
| DailyTask | 每日任务 |
| ChatHistory | AI 对话历史 |
| ErrorCase | 错题记录（三问答案、AI 分析） |
| PreventionRule | 防错规则（触发统计） |
| SystemPrompt | 系统提示词（15 个，管理员可编辑） |
| Badge | 成就徽章 |
| MockExamResult | 模拟考试记录 |

---

## 本地开发

```bash
git clone https://github.com/zhaoyidemo/GESPAI.git
cd gespai
npm install
cp .env.example .env       # 编辑 .env 填入配置
npx prisma generate        # 生成 Prisma Client
npx prisma db push         # 同步数据库表结构
npm run dev                # 启动开发服务器
```

## 环境变量

| 变量名 | 必填 | 说明 |
|--------|------|------|
| DATABASE_URL | 是 | PostgreSQL 连接字符串 |
| NEXTAUTH_SECRET | 是 | NextAuth 密钥 |
| NEXTAUTH_URL | 是 | 应用 URL |
| ANTHROPIC_API_KEY | 是 | Claude API 密钥 |
| JUDGE0_API_URL | 是 | Judge0 API 端点 |
| JUDGE0_API_KEY | 是 | Judge0 API 密钥 |
| NEXT_PUBLIC_IFLYTEK_ENABLED | 否 | 讯飞语音识别开关 |
| NEXT_PUBLIC_IFLYTEK_APP_ID | 否 | 讯飞应用 ID |
| IFLYTEK_API_KEY | 否 | 讯飞 API 密钥 |
| IFLYTEK_API_SECRET | 否 | 讯飞 API 秘钥 |

## 部署（Railway）

1. Railway 创建新项目，添加 PostgreSQL 数据库
2. 连接 GitHub 仓库
3. 配置环境变量
4. 推送代码，自动构建部署（构建命令已包含 `prisma db push`）

## License

MIT
