import { NextResponse } from "next/server";
import prisma from "@/lib/db";

// GESP 8级完整题库 - 来源：洛谷 CCF GESP C++ 八级上机题
// 官方题单：https://www.luogu.com.cn/training/558
// 所有内容与洛谷100%一致

const gesp8Problems = [
  // ========== 样题 ==========
  {
    title: "[GESP样题 八级] 区间",
    source: "gesp_official",
    sourceId: "P10288",
    sourceUrl: "https://www.luogu.com.cn/problem/P10288",
    level: 8,
    knowledgePoints: ["离散化", "二分查找", "区间查询"],
    difficulty: "普及/提高-",
    description: `小杨有一个长度为 $n$ 的正整数序列 $A$。

小杨有 $q$ 次询问。第 $i$ 次（$1\\le i\\le q$）询问时，小杨会给出 $l_i,r_i,x_i$，请你求出 $x_i$ 在 $A_{l_i}, A_{l_i+1}, \\dots A_{r_i}$ 中出现的次数。`,
    inputFormat: `第一行包含一个正整数 $T$，表示数据组数。

对于每组数据：第一行包含一个正整数 $n$，表示序列 $A$ 的长度。
第二行包含 $n$ 个正整数 $A_1,A_2,\\dots,A_n$，表示序列 $A$。
第三行包含一个正整数 $q$，表示询问次数。接下来 $q$ 行，每行三个正整数 $l_i,r_i,x_i$，表示一组询问。`,
    outputFormat: `对于每组数据，输出 $q$ 行。第 $i$ 行（$1\\le i\\le q$）输出一个非负整数，表示第 $i$ 次询问的答案。`,
    samples: [
      { input: `2\n5\n7 4 6 1 1\n2\n1 2 3\n1 5 1\n5\n1 2 3 4 5\n2\n5 5 3\n1 4 3`, output: `0\n2\n0\n1` },
    ],
    testCases: [
      // 原始样例
      { input: `2\n5\n7 4 6 1 1\n2\n1 2 3\n1 5 1\n5\n1 2 3 4 5\n2\n5 5 3\n1 4 3`, output: `0\n2\n0\n1` },
      // 边界：最小数据 n=1, q=1
      { input: `1\n1\n1\n1\n1 1 1`, output: `1` },
      // 边界：查询不存在的元素
      { input: `1\n3\n1 2 3\n1\n1 3 100`, output: `0` },
      // 全部相同的元素
      { input: `1\n5\n7 7 7 7 7\n3\n1 5 7\n2 4 7\n1 1 7`, output: `5\n3\n1` },
      // 全部不同的元素
      { input: `1\n5\n1 2 3 4 5\n5\n1 5 1\n1 5 2\n1 5 3\n1 5 4\n1 5 5`, output: `1\n1\n1\n1\n1` },
      // 单点查询
      { input: `1\n5\n1 2 3 4 5\n5\n1 1 1\n2 2 2\n3 3 3\n4 4 4\n5 5 5`, output: `1\n1\n1\n1\n1` },
      // 区间查询结果为0
      { input: `1\n5\n1 1 1 1 1\n3\n1 5 2\n2 4 3\n3 3 5`, output: `0\n0\n0` },
      // 大值元素（测试离散化）
      { input: `1\n5\n1000000000 999999999 1000000000 1 1000000000\n3\n1 5 1000000000\n1 5 999999999\n1 5 1`, output: `3\n1\n1` },
      // 多组数据测试
      { input: `3\n3\n1 2 1\n2\n1 3 1\n1 2 2\n2\n5 5\n1\n1 2 5\n4\n1 1 1 1\n2\n1 4 1\n2 3 1`, output: `2\n1\n2\n4\n2` },
      // 区间左右端点相同
      { input: `1\n5\n3 1 4 1 5\n5\n1 1 3\n2 2 1\n3 3 4\n4 4 1\n5 5 5`, output: `1\n1\n1\n1\n1` },
      // 连续相同元素
      { input: `1\n10\n1 1 1 2 2 2 3 3 3 3\n4\n1 10 1\n1 10 2\n1 10 3\n4 9 2`, output: `3\n3\n4\n3` },
      // 查询子区间
      { input: `1\n6\n1 2 1 2 1 2\n4\n1 6 1\n2 5 1\n3 4 1\n1 2 1`, output: `3\n2\n1\n1` },
    ],
    timeLimit: 1000,
    memoryLimit: 128,
    hint: `|子任务|分值|$n$|$q$|$\\max A_i$|
|-|-|-|-|-|
|$1$|$30$|$\\le 100$|$\\le 100$|$\\le 10$|
|$2$|$30$|$\\le 10^5$|$\\le 10^5$|$\\le 10^5$|
|$3$|$40$|$\\le 10^5$|$\\le 10^5$|$\\le 10^9$|

对于全部数据，保证有 $1 \\leq T\\le 5$，$1 \\le n,q\\le 10^5$，$1 \\le A_i\\le 10^9$。`,
  },
  {
    title: "[GESP样题 八级] 小杨的旅游",
    source: "gesp_official",
    sourceId: "P10289",
    sourceUrl: "https://www.luogu.com.cn/problem/P10289",
    level: 8,
    knowledgePoints: ["树", "LCA", "BFS", "图论"],
    difficulty: "普及+/提高",
    description: `小杨准备前往 B 国旅游。

B 国有 $n$ 座城市，这 $n$ 座城市依次以 $1$ 至 $n$ 编号。城市之间由 $n-1$ 条双向道路连接，任意两座城市之间均可达（即任意两座城市之间存在可达的路径）。

小杨可以通过双向道路在城市之间移动，通过一条双向道路需要 $1$ 单位时间。

B 国城市中有 $k$ 座城市设有传送门。设有传送门的城市的编号依次为 $b_1,b_2, \\cdots ,b_k$。小杨可以从任意一座设有传送门的城市花费 $0$ 单位时间前往另一座设有传送门的城市。

注：如果两座设有传送门的城市之间存在双向道路，那么小杨可以选择通过双向道路移动，也可以选择通过传送门传送。

小杨计划在 B 国旅游 $q$ 次。第 $i$ 次旅游（$1 \\le i \\le q$），小杨计划从编号为 $u_i$ 的城市前往编号为 $v_i$ 的城市，小杨希望你能求出所需要的最短时间。`,
    inputFormat: `第一行包含三个正整数 $n,k,q$，分别表示 B 国的城市数量，设有传送门的城市数量，以及小杨计划在 B 国旅游的次数。
接下来 $n-1$ 行，每行包含两个正整数 $x_i, y_i$，表示一条双向道路连接的两座城市的编号。
第 $n + 1$ 行包含 $k$ 个正整数，表示设有传送门的城市的编号。
接下来 $q$ 行，每行包含两个正整数 $u_i,v_i$，表示小杨第 $i$ 次旅游行程的起点城市编号与终点城市编号。`,
    outputFormat: `输出共 $q$ 行。第 $i$ 行（$1 \\leq i \\leq q$）输出一个非负整数，表示小杨计划第 $i$ 次旅游从编号为 $u_i$ 的城市前往编号为 $v_i$ 的城市所需要的最短时间。`,
    samples: [
      { input: `7 2 1\n5 7\n3 6\n2 3\n1 5\n5 4\n1 2\n7 4\n3 7`, output: `4` },
      { input: `5 0 3\n2 3\n5 1\n5 2\n1 4\n4 5\n1 4\n4 3`, output: `2\n1\n4` },
    ],
    testCases: [
      // 原始样例
      { input: `7 2 1\n5 7\n3 6\n2 3\n1 5\n5 4\n1 2\n7 4\n3 7`, output: `4` },
      { input: `5 0 3\n2 3\n5 1\n5 2\n1 4\n4 5\n1 4\n4 3`, output: `2\n1\n4` },
      // 边界：最小树 n=2, k=0
      { input: `2 0 1\n1 2\n\n1 2`, output: `1` },
      // k=0 无传送门，纯LCA
      { input: `5 0 3\n1 2\n1 3\n2 4\n2 5\n\n4 5\n3 4\n3 5`, output: `2\n3\n3` },
      // 所有节点都有传送门
      { input: `4 4 3\n1 2\n2 3\n3 4\n1 2 3 4\n1 4\n1 3\n2 4`, output: `0\n0\n0` },
      // 链状树
      { input: `5 1 3\n1 2\n2 3\n3 4\n4 5\n3\n1 5\n1 2\n4 5`, output: `4\n1\n1` },
      // 星状树（一个中心连接所有）
      { input: `5 2 3\n1 2\n1 3\n1 4\n1 5\n2 5\n3 4\n2 3\n4 5`, output: `2\n2\n2` },
      // 传送门在叶子节点
      { input: `5 2 3\n1 2\n1 3\n2 4\n2 5\n4 5\n3 4\n3 5\n1 4`, output: `3\n3\n2` },
      // 传送门在路径中间
      { input: `6 1 2\n1 2\n2 3\n3 4\n4 5\n5 6\n3\n1 6\n2 5`, output: `5\n3` },
      // 多个传送门，选择最优
      { input: `7 3 2\n1 2\n2 3\n3 4\n1 5\n5 6\n6 7\n2 5 4\n3 6\n7 4`, output: `2\n2` },
      // 起点或终点就是传送门
      { input: `5 2 3\n1 2\n2 3\n3 4\n4 5\n1 5\n1 3\n5 3\n1 5`, output: `2\n2\n0` },
      // 完全二叉树结构
      { input: `7 2 3\n1 2\n1 3\n2 4\n2 5\n3 6\n3 7\n4 7\n4 6\n5 7\n4 5`, output: `2\n2\n2` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `| 子任务 | 分值 | $n \\leq $ | $ k \\leq $ | $q \\leq $ |
|:-: | :-: | :-: | :-: | :-:|
| $1$ | $30$ | $500$ | $500$ | $1$ |
| $2$ | $30$ | $2 \\times 10^5$ | $0$ | $2 \\times 10^5$ |
| $3$ | $40$ | $2 \\times 10^5$ | $2 \\times 10^5$ | $2 \\times 10^5$ |

对全部的测试数据，$1 \\leq n \\leq 2 \\times 10^5$，$0 \\leq k \\leq n$，$1 \\leq x_i, y_i, u_i, v_i \\leq n$，$u_i \\neq v_i$。`,
  },
  // ========== 2023年12月 ==========
  {
    title: "[GESP202312 八级] 奖品分配",
    source: "gesp_official",
    sourceId: "P10112",
    sourceUrl: "https://www.luogu.com.cn/problem/P10112",
    level: 8,
    knowledgePoints: ["组合数学", "多项式", "取模运算"],
    difficulty: "普及/提高-",
    description: `班上有 $N$ 名同学，学号从 $0$ 到 $N-1$。有 $M$ 种奖品要分给这些同学，其中，第 $i$ 种奖品总共有 $a_i$ 个 （$i=0,1, \\cdots ,M-1$）。

巧合的是，奖品的数量不多不少，每位同学都可以恰好分到一个奖品，且最后剩余的奖品不超过 $1$ 个（即：$N\\le a_0+a_1+ \\cdots +a_{M-1}\\le N+1$）。

现在，请你求出每个班级礼物分配的方案数，所谓方案，指的是为每位同学都分配一个种类的奖品。

只要有一位同学获得了不同种类的奖品，即视为不同的方案。方便起见，你只需要输出方案数对 $10^{9}+7$ 取模后的结果即可。

共有 $T$ 个班级都面临着奖品分配的问题，你需要依次为他们解答。`,
    inputFormat: `第一行一个整数 $T$，表示班级数量。

接下来 $T$ 行，每行若干用单个空格隔开的正整数。首先是两个正整数$N,M$，接着是 $M$ 个正整数 $a_0,a_1...a_{M-1}$。保证 $N \\le a_0+a_1+\\cdots+a_{M-1} \\le N+1 $。`,
    outputFormat: `输出 $T$ 行，每行一个整数，表示该班级分配奖品的方案数对 $10^{9}+7$ 取模的结果。`,
    samples: [
      { input: `3\n3 2 1 2\n3 2 1 3\n5 3 1 3 1`, output: `3\n4\n20` },
      { input: `5\n100 1 100\n100 1 101\n20 2 12 8\n123 4 80 20 21 3\n999 5 101 234 499 66 99`, output: `1\n1\n125970\n895031741\n307187590` },
    ],
    testCases: [
      // 原始样例
      { input: `3\n3 2 1 2\n3 2 1 3\n5 3 1 3 1`, output: `3\n4\n20` },
      { input: `5\n100 1 100\n100 1 101\n20 2 12 8\n123 4 80 20 21 3\n999 5 101 234 499 66 99`, output: `1\n1\n125970\n895031741\n307187590` },
      // 边界：最小情况 N=1, M=1
      { input: `1\n1 1 1`, output: `1` },
      // 边界：N=1, 刚好多一个奖品
      { input: `1\n1 1 2`, output: `1` },
      // 只有一种奖品，数量刚好
      { input: `1\n5 1 5`, output: `1` },
      // 只有一种奖品，多一个
      { input: `1\n5 1 6`, output: `1` },
      // M=2，简单组合
      { input: `3\n2 2 1 1\n4 2 2 2\n6 2 3 3`, output: `2\n6\n20` },
      // 每种奖品只有1个
      { input: `2\n3 3 1 1 1\n4 4 1 1 1 1`, output: `6\n24` },
      // 多种奖品，有一种数量很大
      { input: `2\n5 2 1 5\n5 2 4 2`, output: `6\n15` },
      // 多1个奖品的情况
      { input: `2\n3 3 1 1 2\n4 3 2 1 2`, output: `12\n30` },
      // 大规模测试
      { input: `2\n10 3 4 3 3\n10 2 5 5`, output: `4200\n252` },
      // 组合数溢出测试
      { input: `1\n500 2 250 250`, output: `515561345` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `**样例解释 1**

对于第 $1$ 个班级，学号为 $0,1,2$ 的同学可以依次分别获得奖品 $0,1,1$，也可以依次分别获得奖品 $1,0,1$，也可以依次分别获得奖品 $1,1,0$ ，因此共有 $3$ 种方案。

对于第 $2$ 个班级，学号为 $0,1,2$ 的同学可以依次分别获得奖品 $0,1,1$ ，也可以依次分别获得奖品 $1,0,1$，也可以依次分别获得奖品 $1,1,0$，也可以依次分别获得奖品 $1,1,1$，因此共有 $4$ 种方案。

对于第 $3$ 个班级，可以把编号为 $0$ 的奖品分配给 $5$ 名同学中的任意一名，共有 $5$ 种方案；再把编号为 $2$ 的奖品分配给剩余 $4$ 名同学中的任意一名，共有$4$ 种方案；最后给剩余 $3$ 名同学自然获得 $1$ 号奖品。因此，方案数为 $5 \\times 4 = 20$。

**数据范围**

对于 $30\\%$ 的测试点，保证 $N \\le 10$。

对于另外 $30\\%$ 的测试点，保证 $M=2$。

对于所有测试点，保证 $N \\le 1000$；保证 $T \\le 1000$ ；保证 $M \\le 1001$。`,
  },
  {
    title: "[GESP202312 八级] 大量的工作沟通",
    source: "gesp_official",
    sourceId: "P10113",
    sourceUrl: "https://www.luogu.com.cn/problem/P10113",
    level: 8,
    knowledgePoints: ["树", "LCA", "DFS"],
    difficulty: "普及/提高-",
    description: `某公司有 $N$ 名员工，编号从 $0$ 至 $N-1$。其中，除了 $0$ 号员工是老板，其余每名员工都有一个直接领导。我们假设编号为 $i$ 的员工的直接领导是 $f_i$。

该公司有严格的管理制度，每位员工只能受到本人或直接领导或间接领导的管理。具体来说，规定员工 $x$ 可以管理员工 $y$，当且仅当 $x=y$，或 $x=f_y$，或 $x$ 可以管理 $f_y$。特别地，$0$ 号员工老板只能自我管理，无法由其他任何员工管理。

现在，有一些同事要开展合作，他们希望找到一位同事来主持这场合作，这位同事必须能够管理参与合作的所有同事。如果有多名满足这一条件的员工，他们希望找到编号最大的员工。你能帮帮他们吗？`,
    inputFormat: `第一行一个整数 $N$ ，表示员工的数量。

第二行 $N-1$ 个用空格隔开的正整数，依次为 $f_1, f_2, \\dots f_{N-1}$。

第三行一个整数 $Q$ ，表示共有 $Q$ 场合作需要安排。

接下来 $Q$ 行，每行描述一场合作：开头是一个整数 $m$（$2 \\leq m \\leq N$），表示参与本次合作的员工数量；接着是 $m$ 个整数，依次表示参与本次合作的员工编号（保证编号合法且不重复）。

保证公司结构合法，即不存在任意一名员工，其本人是自己的直接或间接领导。`,
    outputFormat: `输出 $Q$ 行，每行一个整数，依次为每场合作的主持人选。`,
    samples: [
      { input: `5\n0 0 2 2\n3\n2 3 4\n3 2 3 4\n2 1 4`, output: `2\n2\n0` },
      { input: `7\n0 1 0 2 1 2\n5\n2 4 6\n2 4 5\n3 4 5 6\n4 2 4 5 6\n2 3 4`, output: `2\n1\n1\n1\n0` },
    ],
    testCases: [
      // 原始样例
      { input: `5\n0 0 2 2\n3\n2 3 4\n3 2 3 4\n2 1 4`, output: `2\n2\n0` },
      { input: `7\n0 1 0 2 1 2\n5\n2 4 6\n2 4 5\n3 4 5 6\n4 2 4 5 6\n2 3 4`, output: `2\n1\n1\n1\n0` },
      // 边界：最小树 N=3
      { input: `3\n0 0\n1\n2 1 2`, output: `0` },
      // 只有两人合作，是父子关系
      { input: `4\n0 0 1\n2\n2 1 3\n2 2 3`, output: `1\n0` },
      // 链状树结构
      { input: `5\n0 1 2 3\n3\n2 3 4\n2 1 4\n2 2 4`, output: `3\n1\n2` },
      // 所有人都参与合作
      { input: `4\n0 0 0\n1\n4 0 1 2 3`, output: `0` },
      // 参与者包含老板
      { input: `5\n0 0 1 2\n2\n3 0 3 4\n2 0 1`, output: `0\n0` },
      // 同一子树下的员工
      { input: `6\n0 1 1 2 2\n3\n2 3 4\n2 4 5\n3 3 4 5`, output: `1\n2\n1` },
      // 不同子树的员工
      { input: `7\n0 0 1 1 2 2\n3\n2 3 5\n2 4 6\n4 3 4 5 6`, output: `0\n0\n0` },
      // LCA就是参与者之一
      { input: `5\n0 1 2 2\n2\n2 2 3\n3 2 3 4`, output: `2\n2` },
      // 深树结构
      { input: `6\n0 1 2 3 4\n3\n2 4 5\n2 3 5\n2 1 5`, output: `4\n3\n1` },
      // 多人合作，选最大编号LCA
      { input: `8\n0 0 1 1 2 2 3\n2\n3 4 5 7\n4 3 4 5 6`, output: `0\n0` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `**样例解释 1**

对于第一场合作，员工 $3,4$ 有共同领导 $2$ ，可以主持合作。

对于第二场合作，员工 $2$ 本人即可以管理所有参与者。

对于第三场合作，只有 $0$ 号老板才能管理所有员工。

**数据范围**

对于 $25\\%$ 的测试点，保证 $N \\leq 50$。

对于 $50\\%$ 的测试点，保证 $N \\leq 300$。

对于所有测试点，保证 $3 \\leq N \\leq 10^5$，$Q \\leq 100$，$m \\leq 10^4$。

------------

2024/2/8 添加一组 hack 数据。`,
  },
  // ========== 2024年3月 ==========
  {
    title: "[GESP202403 八级] 公倍数问题",
    source: "gesp_official",
    sourceId: "P10263",
    sourceUrl: "https://www.luogu.com.cn/problem/P10263",
    level: 8,
    knowledgePoints: ["数论", "最小公倍数", "枚举", "数学"],
    difficulty: "普及/提高-",
    description: `小 A 写了一个 $N \\times M$ 的矩阵 $A$，我们看不到这个矩阵，但我们可以知道，其中第 $i$ 行第 $j$ 列的元素 $A_{i,j}$ 是 $i$ 和 $j$ 的公倍数（$i=1,\\dots,N$，$j=1,\\dots,M$）。现在有 $K$ 个小朋友，其中第 $k$ 个小朋友想知道，矩阵 $A$ 中最多有多少个元素可以是 $k$（$k=1,2,\\dots,K$）。请你帮助这些小朋友求解。

注意：每位小朋友的答案互不相关，例如，有些位置既可能是 $x$，又可能是 $y$，则它同时可以满足 $x,y$ 两名小朋友的要求。

方便起见，你只需要输出 $\\sum_{k=1}^{K}{k \\times \\texttt{ans}_k}$ 即可，其中 $\\texttt{ans}_k$ 表示第 $k$ 名小朋友感兴趣的答案。`,
    inputFormat: `第一行三个正整数 $N,M,K$。`,
    outputFormat: `输出一行，即 $\\sum_{k=1}^{K}{k \\times \\texttt{ans}_k}$。

请注意，这个数可能很大，使用 C++ 语言的选手请酌情使用 \`long long\` 等数据类型存储答案。`,
    samples: [
      { input: `2 5 2`, output: `9` },
      { input: `100 100 100`, output: `185233` },
    ],
    testCases: [
      // 原始样例
      { input: `2 5 2`, output: `9` },
      { input: `100 100 100`, output: `185233` },
      // 边界：最小 N=M=K=1
      { input: `1 1 1`, output: `1` },
      // N=M，正方形矩阵
      { input: `3 3 3`, output: `21` },
      // K>N*M，一些k无法满足
      { input: `2 2 10`, output: `145` },
      // N和M差距较大
      { input: `1 10 5`, output: `33` },
      { input: `10 1 5`, output: `33` },
      // 质数测试
      { input: `7 7 7`, output: `201` },
      // K=1，只统计(1,1)
      { input: `10 10 1`, output: `1` },
      // K=2
      { input: `5 5 2`, output: `9` },
      // 中等规模
      { input: `50 50 50`, output: `33864` },
      // N和M不相等
      { input: `30 20 25`, output: `5530` },
      // 较大K但N,M较小
      { input: `10 10 100`, output: `59584` },
    ],
    timeLimit: 1000,
    memoryLimit: 128,
    hint: `### 样例 1 解释

只有 $A_{1,1}$ 可以是 $1$，其余都不行。

$A_{1,1},A_{1,2},A_{2,1},A_{2,2}$ 都可以是 $2$，而其余不行。

因此答案是 $1 \\times 1 + 2 \\times 4 = 9$。

### 数据规模

对于 $30\\%$ 的测试点，保证 $N,M,K \\leq 10$；

对于 $60\\%$ 的测试点，保证 $N,M,K \\leq 500$；

对于 $100\\%$ 的测试点，保证 $N,M \\leq 10^5$，$K \\leq 10^6$。`,
  },
  {
    title: "[GESP202403 八级] 接竹竿",
    source: "gesp_official",
    sourceId: "P10264",
    sourceUrl: "https://www.luogu.com.cn/problem/P10264",
    level: 8,
    knowledgePoints: ["模拟", "栈", "区间查询", "动态规划"],
    difficulty: "普及+/提高",
    description: `小杨同学想用卡牌玩一种叫做"接竹竿"的游戏。

游戏规则是：每张牌上有一个点数 $v$，将给定的牌依次放入一列牌的末端。若放入之前这列牌中已有与这张牌点数相同的牌，则小杨同学会将这张牌和点数相同的牌之间的所有牌全部取出队列（包括这两张牌本身）。

小杨同学现在有一个长度为 $n$ 的卡牌序列 $A$，其中每张牌的点数为 $A_i$（$1\\le i\\le n$）。小杨同学有 $q$ 次询问。第 $i$ 次（$1\\le i\\le q$）询问时，小杨同学会给出 $l_i,r_i$ 小杨同学想知道如果用下标在 $[l_i,r_i]$ 的所有卡牌按照下标顺序玩"接竹竿"的游戏，最后队列中剩余的牌数。`,
    inputFormat: `一行包含一个正整数 $T$，表示测试数据组数。

对于每组测试数据，第一行包含一个正整数 $n$，表示卡牌序列 $A$ 的长度。

第二行包含 $n$ 个正整数 $A_1,A_2,\\dots,A_n$，表示卡牌的点数 $A$。

第三行包含一个正整数 $q$，表示询问次数。

接下来 $q$ 行，每行两个正整数 $l_i,r_i$ 表示一组询问。`,
    outputFormat: `对于每组数据，输出 $q$ 行。第 $i$ 行（$1\\le i\\le q$）输出一个非负整数，表示第 $i$ 次询问的答案。`,
    samples: [
      { input: `1\n6\n1 2 2 3 1 3\n4\n1 3\n1 6\n1 5\n5 6`, output: `1\n1\n0\n2` },
    ],
    testCases: [
      // 原始样例
      { input: `1\n6\n1 2 2 3 1 3\n4\n1 3\n1 6\n1 5\n5 6`, output: `1\n1\n0\n2` },
      // 边界：n=1，单张牌
      { input: `1\n1\n5\n1\n1 1`, output: `1` },
      // 全部相同的牌
      { input: `1\n5\n1 1 1 1 1\n3\n1 2\n1 3\n1 5`, output: `0\n1\n1` },
      // 全部不同的牌
      { input: `1\n5\n1 2 3 4 5\n3\n1 5\n2 4\n1 3`, output: `5\n3\n3` },
      // 连续配对
      { input: `1\n6\n1 1 2 2 3 3\n3\n1 2\n1 4\n1 6`, output: `0\n0\n0` },
      // 嵌套配对 (类似括号匹配)
      { input: `1\n6\n1 2 3 3 2 1\n2\n1 6\n2 5`, output: `0\n0` },
      // 部分配对
      { input: `1\n5\n1 2 1 3 4\n3\n1 3\n1 5\n3 5`, output: `0\n2\n3` },
      // 最大点数13
      { input: `1\n6\n1 13 5 13 1 5\n3\n1 4\n2 6\n1 6`, output: `1\n2\n1` },
      // 多组测试数据
      { input: `2\n3\n1 2 1\n2\n1 3\n1 2\n4\n1 1 2 2\n2\n1 4\n2 3`, output: `0\n2\n0\n2` },
      // 单点查询
      { input: `1\n5\n1 2 3 4 5\n5\n1 1\n2 2\n3 3\n4 4\n5 5`, output: `1\n1\n1\n1\n1` },
      // 复杂嵌套
      { input: `1\n8\n1 2 3 2 3 1 4 4\n4\n1 8\n1 6\n3 6\n7 8`, output: `0\n0\n1\n0` },
      // 无法配对剩余多张
      { input: `1\n7\n1 2 3 4 5 6 7\n2\n1 7\n3 6`, output: `7\n4` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `**样例解释**

对于第一次询问，小杨同学会按照 $1,2,2$ 的顺序放置卡牌，在放置最后一张卡牌时，两张点数为 $2$ 的卡牌会被收走，因此最后队列中只剩余一张点数为 $1$ 的卡牌。

对于第二次询问，队列变化情况为：

$\\{\\}\\to\\{1\\}\\to\\{1,2\\}\\to\\{1,2,2\\}\\to\\{1\\}\\to\\{1,3\\}\\to\\{1,3,1\\}\\to\\{\\}\\to\\{3\\}$。因此最后队列中只剩余一张点数为 $3$ 的卡牌。

**数据范围**

|子任务|分数|$T$|$n$|$q$|$\\max A_i$|特殊条件|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|$1$|$30$|$\\le 5$|$\\le100$|$\\le100$|$\\le13$|
|$2$|$30$|$\\le 5$|$\\le 1.5\\times10^4$|$\\le 1.5\\times10^4$|$\\le13$|所有询问的右端点等于 $n$|
|$3$|$40$|$\\le 5$|$\\le 1.5\\times10^4$|$\\le 1.5\\times10^4$|$\\le13$|

对于全部数据，保证有 $1\\le T\\le 5$，$1\\le n\\le 1.5\\times 10^4$，$1\\le q\\le 1.5\\times 10^4$，$1\\le A_i\\le 13$。`,
  },
  // ========== 2024年6月 ==========
  {
    title: "[GESP202406 八级] 最远点对",
    source: "gesp_official",
    sourceId: "P10725",
    sourceUrl: "https://www.luogu.com.cn/problem/P10725",
    level: 8,
    knowledgePoints: ["树", "BFS", "DFS", "树的直径"],
    difficulty: "普及+/提高",
    description: `小杨有一棵包含 $n$ 个节点的树，这棵树上的任意一个节点要么是白色，要么是黑色。

小杨想知道相距最远的一对不同颜色节点的距离是多少。`,
    inputFormat: `第一行包含一个正整数 $n$，代表树的节点数。

第二行包含 $n$ 个非负整数 $a_1,a_2,\\cdots,a_n$（对于所有的 $1\\le i\\le n$，均有 $a_i$ 等于 $0$ 或 $1$），其中如果 $a_i=0$，则节点 $i$ 的颜色为白色；如果 $a_i=1$，则节点 $i$ 的颜色为黑色。

之后 $(n-1)$ 行，每行包含两个正整数 $x_i,y_i$，代表存在一条连接节点 $x_i$ 和 $y_i$ 的边。

保证输入的树中存在不同颜色的点。`,
    outputFormat: `输出一个整数，代表相距最远的一对不同颜色节点的距离。`,
    samples: [
      { input: `5\n0 1 0 1 0\n1 2\n1 3\n3 4\n3 5`, output: `3` },
    ],
    testCases: [
      // 原始样例
      { input: `5\n0 1 0 1 0\n1 2\n1 3\n3 4\n3 5`, output: `3` },
      // 边界：n=2，最小树
      { input: `2\n0 1\n1 2`, output: `1` },
      // 链状树
      { input: `5\n0 0 1 1 0\n1 2\n2 3\n3 4\n4 5`, output: `3` },
      // 星状树
      { input: `5\n0 1 1 1 1\n1 2\n1 3\n1 4\n1 5`, output: `1` },
      // 只有一个黑色节点
      { input: `4\n0 0 0 1\n1 2\n2 3\n3 4`, output: `3` },
      // 只有一个白色节点
      { input: `4\n1 1 1 0\n1 2\n2 3\n3 4`, output: `3` },
      // 黑白交替
      { input: `5\n0 1 0 1 0\n1 2\n2 3\n3 4\n4 5`, output: `3` },
      // 完全二叉树结构
      { input: `7\n0 1 0 1 0 1 0\n1 2\n1 3\n2 4\n2 5\n3 6\n3 7`, output: `4` },
      // 直径端点不同色
      { input: `6\n0 0 0 1 0 0\n1 2\n2 3\n3 4\n4 5\n4 6`, output: `3` },
      // 直径端点同色，需要找其他路径
      { input: `6\n0 0 0 0 0 1\n1 2\n2 3\n3 4\n4 5\n3 6`, output: `3` },
      // 复杂树结构
      { input: `8\n0 1 0 1 0 1 0 1\n1 2\n1 3\n2 4\n2 5\n3 6\n3 7\n6 8`, output: `5` },
      // 两端都是同色，中间不同色
      { input: `5\n1 0 0 0 1\n1 2\n2 3\n3 4\n4 5`, output: `3` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `#### 样例解释

相距最远的不同颜色的一对节点为节点 $2$ 和 $5$。

#### 数据范围

**本题采用捆绑测试。**

| 子任务编号 | 得分 | $n$ | $a_i$ | 特殊条件 |
| :--: | :--: | :--: | :--: | :--: |
| $1$ | $30$ | $\\le 10^5$ | $0\\le a_i\\le 1$ | 树的形态为一条链 |
| $2$ | $30$ | $\\le 10^3$ | $0\\le a_i\\le 1$ | |
| $3$ | $40$ | $\\le 10^5$ | $0\\le a_i\\le 1$ | |

对于全部数据，保证有 $1\\le n\\le 10^5$，$0\\le a_i\\le 1$。`,
  },
  {
    title: "[GESP202406 八级] 空间跳跃",
    source: "gesp_official",
    sourceId: "P10726",
    sourceUrl: "https://www.luogu.com.cn/problem/P10726",
    level: 8,
    knowledgePoints: ["图论", "最短路", "模拟", "贪心"],
    difficulty: "普及+/提高",
    description: `小杨在二维空间中有 $n$ 个水平挡板，并且挡板之间彼此不重叠，其中第 $i$ 个挡板处于水平高度 $h_i$，左右端点分别位于 $l_i$ 与 $r_i$。小杨可以在挡板上左右移动，当小杨移动到右端点时，如果再向右移动会竖直掉落，从而落到下方第一个挡板上，移动到左端点时同理。小杨在挡板上每移动 $1$ 个单位长度会耗费 $1$ 个单位时间，掉落时每掉落 $1$ 个单位高度也会耗费 $1$ 个单位时间。小杨想知道，从第 $s$ 个挡板上的左端点出发到第 $t$ 个挡板需要耗费的最少时间是多少？注意：可能无法从第 $s$ 个挡板到达到第 $t$ 个挡板。`,
    inputFormat: `第一行包含一个正整数 $n$，代表挡板数量。第二行包含两个正整数 $s,t$，含义如题面所示。之后 $n$ 行，每行包含三个正整数 $l_i,r_i,h_i$，代表第 $i$ 个挡板的左右端点位置与高度。`,
    outputFormat: `输出一个整数代表需要耗费的最少时间，如果无法到达则输出 $-1$。`,
    samples: [
      { input: `3\n3 1\n5 6 3\n3 5 6\n1 4 100000`, output: `100001` },
    ],
    testCases: [
      // 原始样例
      { input: `3\n3 1\n5 6 3\n3 5 6\n1 4 100000`, output: `100001` },
      // 边界：n=1，起点终点相同
      { input: `1\n1 1\n1 5 10`, output: `0` },
      // 无法到达（目标在上方）
      { input: `2\n1 2\n1 3 5\n1 3 10`, output: `-1` },
      // 直接下落可达
      { input: `2\n2 1\n1 5 1\n1 5 10`, output: `9` },
      // 需要移动后才能下落
      { input: `2\n2 1\n3 5 1\n1 2 10`, output: `-1` },
      // 阶梯式下落
      { input: `3\n3 1\n1 3 1\n2 4 5\n3 5 10`, output: `11` },
      // 左右都可以下落，选最优
      { input: `3\n3 1\n2 4 1\n1 5 5\n1 5 10`, output: `-1` },
      // 不重叠的挡板，无法到达
      { input: `2\n2 1\n10 15 1\n1 5 10`, output: `-1` },
      // 复杂路径
      { input: `4\n4 1\n1 3 1\n4 6 5\n2 5 10\n1 6 20`, output: `19` },
      // 相邻挡板
      { input: `3\n3 1\n1 2 1\n2 3 2\n3 4 3`, output: `4` },
      // 长挡板，需要走很远
      { input: `2\n2 1\n1 100 1\n50 60 10`, output: `58` },
      // 多条路径选择
      { input: `4\n4 1\n1 5 1\n1 3 3\n4 6 3\n1 6 10`, output: `9` },
    ],
    timeLimit: 1000,
    memoryLimit: 500,
    hint: `### 样例解释

耗费时间最少的移动方案为，从第 $3$ 个挡板左端点移动到右端点，耗费 $3$ 个单位时间，然后向右移动掉落到第 $2$ 个挡板上，耗费 $100000-6=99994$ 个单位时间，之后再向右移动 $1$ 个单位长度，耗费 $1$ 个单位时间，最后向右移动掉落到第 $1$ 个挡板上，耗费 $3$ 个单位时间。共耗费 $100001$ 个单位时间。

### 数据范围

子任务编号|数据点占比|$n$|特殊条件
:-:|:-:|:-:|:-:
$1$|$20\\%$|$\\leq 1000$|$l_i=1$
$2$|$40\\%$|$\\leq 1000$|$l_i=i,r_i=i+1$
$3$|$40\\%$|$\\leq 1000$|

对于全部数据，保证有 $1\\leq n\\leq 1000$，$1\\leq l_i\\leq r_i\\leq 10^5$，$1\\leq h_i\\leq 10^5$。`,
  },
  // ========== 2024年9月 ==========
  {
    title: "[GESP202409 八级] 手套配对",
    source: "gesp_official",
    sourceId: "P11250",
    sourceUrl: "https://www.luogu.com.cn/problem/P11250",
    level: 8,
    knowledgePoints: ["组合数学", "取模运算", "容斥原理"],
    difficulty: "普及/提高-",
    description: `小杨有 $n$ 对不同的手套，每对手套由左右各一只组成。

小杨想知道从中取出 $m$ 只手套，$m$ 只手套恰好包含 $k$ 对手套的情况有多少种。

小杨认为两种取出的情况不同，当且仅当两种情况取出的手套中存在不同的手套（同一对手套的左右手也视为不同的手套）。`,
    inputFormat: `**本题单个测试点内有多组测试数据**。

第一行包含一个正整数 $t$，代表测试用例组数。

接下来是 $t$ 组测试用例。对于每组测试用例，一共一行。

第一行包含三个正整数 $n,m,k$，代表手套数量，取出的手套数和目标对数。`,
    outputFormat: `对于每组测试数据，输出一个整数，代表可能的情况数量对 $10^9+7$ 取模的结果。`,
    samples: [
      { input: `2\n5 6 2\n5 1 5`, output: `120\n0` },
    ],
    testCases: [
      // 原始样例
      { input: `2\n5 6 2\n5 1 5`, output: `120\n0` },
      // 边界：n=1，取1只
      { input: `1\n1 1 0`, output: `2` },
      // 边界：n=1，取2只（成对）
      { input: `1\n1 2 1`, output: `1` },
      // k=0，没有成对
      { input: `2\n3 2 0\n4 3 0`, output: `12\n32` },
      // k=n，全部成对
      { input: `2\n2 4 2\n3 6 3`, output: `1\n1` },
      // 无法满足（m太小）
      { input: `1\n5 1 1`, output: `0` },
      // 无法满足（k太大）
      { input: `1\n3 4 3`, output: `0` },
      // m=2k，刚好成对
      { input: `2\n5 4 2\n4 6 3`, output: `10\n4` },
      // 中等规模
      { input: `3\n10 5 1\n10 8 3\n10 10 5`, output: `6720\n10080\n252` },
      // 边界条件测试
      { input: `2\n5 10 5\n5 9 4`, output: `1\n10` },
      // m > n 的情况
      { input: `2\n3 5 2\n4 7 3`, output: `6\n8` },
      // 大规模取模测试
      { input: `1\n100 50 10`, output: `419931052` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `| 子任务 | 占比 | $t$ | $n$ | $m$ | $k$ |
| :-: | :-: | :-: | :-: | :-: | :-: |
| $1$ | $30\\%$ | $\\leq 5$ | $\\leq 1000$ | $\\le 3$ | $=1$ |
| $2$ | $30\\%$ | $\\leq 5$ | $\\leq 5$ | $\\leq 10$ | $\\leq 5$ |
| $3$ | $40\\%$ | $\\leq 10^5$ | $\\leq 1000$ | $\\leq 2000$ | $\\leq 2000$ |

对全部的测试数据，保证 $1 \\leq t \\leq 10^5,1 \\leq n \\leq 1000,1 \\leq m \\leq 2 \\times n,1 \\leq k \\leq n$。`,
  },
  {
    title: "[GESP202409 八级] 美丽路径",
    source: "gesp_official",
    sourceId: "P11251",
    sourceUrl: "https://www.luogu.com.cn/problem/P11251",
    level: 8,
    knowledgePoints: ["树", "DFS", "动态规划", "树的直径"],
    difficulty: "普及/提高-",
    description: `小杨有一棵包含 $n$ 个节点的树，节点从 $1$ 到 $n$ 编号，并且每个节点要么是白色，要么是黑色。

对于树上的一条简单路径（不经过重复节点的路径），小杨认为它是**美丽**的当且仅当路径上相邻节点的颜色均不相同。例如下图，其中节点 $1$ 和节点 $4$ 是黑色，其余节点是白色，路径 $2-1-3-4$ 是美丽路径，而路径 $2-1-3-5$ 不是美丽路径（相邻节点 $3$ 和 $5$ 颜色相同）。

![](https://cdn.luogu.com.cn/upload/image_hosting/zyz3v6jo.png)

对于树上的一条简单路径，小杨认为它的长度是路径包含节点的数量。小杨想知道**最长的美丽路径**的长度是多少。`,
    inputFormat: `第一行包含一个正整数 $n$，代表节点数量。

第二行包含 $n$ 个整数 $c_1,c_2,\\dots,c_n$，代表每个节点的颜色，如果 $c_i=0$，代表节点 $i$ 为白色，如果 $c_i=1$，代表节点 $i$ 为黑色。

之后 $n-1$ 行，每行包含两个正整数 $u_i,v_i$，代表存在一条连接节点 $u_i$ 和节点 $v_i$ 的边。`,
    outputFormat: `输出一个整数，代表最长美丽路径的长度。`,
    samples: [
      { input: `5\n1 0 0 1 0\n1 2\n3 5\n4 3\n1 3`, output: `4` },
      { input: `5\n0 0 0 0 0\n1 2\n2 3\n3 4\n4 5`, output: `1` },
    ],
    testCases: [
      // 原始样例
      { input: `5\n1 0 0 1 0\n1 2\n3 5\n4 3\n1 3`, output: `4` },
      { input: `5\n0 0 0 0 0\n1 2\n2 3\n3 4\n4 5`, output: `1` },
      // 边界：n=1
      { input: `1\n0`, output: `1` },
      // n=2，颜色相同
      { input: `2\n0 0\n1 2`, output: `1` },
      // n=2，颜色不同
      { input: `2\n0 1\n1 2`, output: `2` },
      // 完美交替链
      { input: `5\n0 1 0 1 0\n1 2\n2 3\n3 4\n4 5`, output: `5` },
      // 全黑
      { input: `4\n1 1 1 1\n1 2\n2 3\n3 4`, output: `1` },
      // 星状树，交替颜色
      { input: `5\n0 1 1 1 1\n1 2\n1 3\n1 4\n1 5`, output: `3` },
      // 星状树，中心和叶子同色
      { input: `5\n0 0 0 0 0\n1 2\n1 3\n1 4\n1 5`, output: `1` },
      // 二叉树结构，交替
      { input: `7\n0 1 1 0 0 0 0\n1 2\n1 3\n2 4\n2 5\n3 6\n3 7`, output: `5` },
      // 复杂树，局部交替
      { input: `6\n0 1 0 1 1 0\n1 2\n2 3\n3 4\n2 5\n5 6`, output: `4` },
      // 只有两种颜色但不连续
      { input: `5\n0 0 1 1 0\n1 2\n2 3\n3 4\n4 5`, output: `2` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `| 子任务编号 | 数据点占比 | $n$ | 特殊条件 |
| :-: | :-: | :-: | :-: |
| $1$ | $30\\%$ | $\\leq 1000$ | 树的形态是一条链 |
| $2$ | $30\\%$ | $\\leq 1000$ | |
| $3$ | $40\\%$ | $\\leq 10^5$ | |

对于全部数据，保证有 $1 \\leq n \\leq 10^5,0 \\leq c_i \\leq 1$，同时保证给出的数据构成一棵树。`,
  },
  // ========== 2024年12月 ==========
  {
    title: "[GESP202412 八级] 树上移动",
    source: "gesp_official",
    sourceId: "P11379",
    sourceUrl: "https://www.luogu.com.cn/problem/P11379",
    level: 8,
    knowledgePoints: ["树", "DFS", "动态规划", "树形DP"],
    difficulty: "普及/提高-",
    description: `小杨有一棵包含 $n$ 个节点的树，其中节点的编号从 $1$ 到 $n$，每个节点的颜色要么是白色要么是黑色，小杨可以任意选择节点 $s$ 和节点 $t$ 并从节点 $s$ 出发移动到节点 $t$，移动过程中小杨不能够经过重复节点。

小杨希望自己在至多经过 $k$ 个黑色节点的前提下，经过的总节点数尽可能多，请你帮小杨选择经过最多的节点数是多少。`,
    inputFormat: `第一行包含两个正整数 $n,k$，代表节点数量和至多经过的黑色节点数。

第二行包含 $n$ 个正整数 $a_1,a_2,\\dots,a_n$，代表节点颜色，如果 $a_i=0$，代表节点颜色为白色，如果 $a_i=1$，代表节点颜色为黑色。

之后 $n-1$ 行，每行包含两个正整数 $u_i,v_i$，代表存在一条连接 $u_i$ 和 $v_i$ 的边。`,
    outputFormat: `输出一个正整数，代表最多经过的节点数。`,
    samples: [
      { input: `5 1\n0 0 1 1 1\n1 2\n2 3\n2 5\n1 4`, output: `3` },
    ],
    testCases: [
      // 原始样例
      { input: `5 1\n0 0 1 1 1\n1 2\n2 3\n2 5\n1 4`, output: `3` },
      // 边界：n=1, k=0
      { input: `1 0\n0`, output: `1` },
      // 边界：n=1, 黑色节点, k=0
      { input: `1 0\n1`, output: `0` },
      // 边界：n=1, 黑色节点, k=1
      { input: `1 1\n1`, output: `1` },
      // 全白节点
      { input: `5 0\n0 0 0 0 0\n1 2\n2 3\n3 4\n4 5`, output: `5` },
      // 全黑节点, k=n
      { input: `4 4\n1 1 1 1\n1 2\n2 3\n3 4`, output: `4` },
      // 全黑节点, k<n
      { input: `5 2\n1 1 1 1 1\n1 2\n2 3\n3 4\n4 5`, output: `2` },
      // k=0, 只能走白色
      { input: `6 0\n0 0 1 0 0 1\n1 2\n2 3\n3 4\n4 5\n5 6`, output: `2` },
      // 链状树，黑白交替
      { input: `5 2\n0 1 0 1 0\n1 2\n2 3\n3 4\n4 5`, output: `5` },
      // 星状树
      { input: `5 1\n0 1 1 1 1\n1 2\n1 3\n1 4\n1 5`, output: `2` },
      // 复杂树
      { input: `7 2\n0 1 0 1 0 1 0\n1 2\n1 3\n2 4\n2 5\n3 6\n3 7`, output: `5` },
      // k很大，无限制
      { input: `5 100\n1 1 1 1 1\n1 2\n2 3\n3 4\n4 5`, output: `5` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `| 子任务编号 | 数据点占比 | $n$ | $k$ | 特殊性质 |
| :--------: | :--------: | :---------: | ----------- | :--------------: |
| $1$ | $20\\%$ | $\\leq 100$ | $\\leq 100$ | 树的形态为一条链 |
| $2$ | $20\\%$ | $\\leq 1000$ | $0$ | |
| $3$ | $60\\%$ | $\\leq 1000$ | $\\leq 1000$ | |

对于全部数据，保证有 $1\\leq n\\leq 1000$，$0\\leq k\\leq 1000$，$0\\leq a_i\\leq 1$。`,
  },
  {
    title: "[GESP202412 八级] 排队",
    source: "gesp_official",
    sourceId: "P11380",
    sourceUrl: "https://www.luogu.com.cn/problem/P11380",
    level: 8,
    knowledgePoints: ["图论", "拓扑排序", "组合数学", "取模运算"],
    difficulty: "普及/提高-",
    description: `小杨所在班级共有 $n$ 位同学，依次以 $1,2,\\dots,n$ 标号。这 $n$ 位同学想排成一行队伍，其中有些同学之间关系非常好，在队伍里需要排在相邻的位置。具体来说，有 $m$ 对这样的关系（$m$ 是一个非负整数）。当 $m\\geq 1$ 时，第 $i$ 对关系（$1\\leq i\\leq m$）给出 $a_i,b_i$，表示排队时编号为 $a_i$ 的同学需要排在编号为 $b_i$ 的同学前面，并且两人在队伍中相邻。

现在小杨想知道总共有多少种排队方式。由于答案可能很大，你只需要求出答案对 $10^9+7$ 取模的结果。`,
    inputFormat: `第一行，两个整数 $n,m$，分别表示同学们的数量与关系数量。

接下来 $m$ 行，每行两个整数 $a_i,b_i$，表示一对关系。`,
    outputFormat: `一行，一个整数，表示答案对 $10^9+7$ 取模的结果。`,
    samples: [
      { input: `4 2\n1 3\n2 4`, output: `2` },
      { input: `3 0`, output: `6` },
      { input: `3 2\n1 2\n2 1`, output: `0` },
    ],
    testCases: [
      // 原始样例
      { input: `4 2\n1 3\n2 4`, output: `2` },
      { input: `3 0`, output: `6` },
      { input: `3 2\n1 2\n2 1`, output: `0` },
      // 边界：n=1, m=0
      { input: `1 0`, output: `1` },
      // n=2, m=0
      { input: `2 0`, output: `2` },
      // n=2, m=1
      { input: `2 1\n1 2`, output: `1` },
      // 形成环（无效）
      { input: `3 3\n1 2\n2 3\n3 1`, output: `0` },
      // 单链
      { input: `4 3\n1 2\n2 3\n3 4`, output: `1` },
      // 多个独立链
      { input: `6 2\n1 2\n3 4`, output: `24` },
      // 一个人有两个约束（入度>1）
      { input: `3 2\n1 3\n2 3`, output: `0` },
      // 一个人约束两人（出度>1）
      { input: `3 2\n1 2\n1 3`, output: `0` },
      // 大规模无约束
      { input: `5 0`, output: `120` },
      // 部分链
      { input: `5 2\n1 2\n2 3`, output: `6` },
      // 复杂情况
      { input: `6 3\n1 2\n3 4\n5 6`, output: `6` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `对于 $20\\%$ 的测试数据点，保证 $1\\leq n\\leq 8$，$0\\leq m\\leq 10$。

对于另外 $20\\%$ 的测试数据点，保证 $1\\leq n\\leq 10^3$，$0\\leq m\\leq 1$。

对于所有测试数据点，保证 $1\\leq n\\leq 2\\times 10^5$，$0\\leq m\\leq 2\\times 10^5$。`,
  },
  // ========== 2025年3月 ==========
  {
    title: "[GESP202503 八级] 上学",
    source: "gesp_official",
    sourceId: "P11966",
    sourceUrl: "https://www.luogu.com.cn/problem/P11966",
    level: 8,
    knowledgePoints: ["图论", "最短路", "dijkstra"],
    difficulty: "普及/提高-",
    description: `C 城可以视为由 $n$ 个结点与 $m$ 条边组成的无向图。这些结点依次以 $1, 2, \\ldots, n$ 标号，边依次以 $1 \\leq i \\leq m$ 连接边号为 $u_i$ 与 $v_i$ 的结点，长度为 $l_i$ 米。

小 A 的学校坐落在 C 城的编号为 $s$ 的结点。小 A 的同学们共有 $q$ 位，他们想在保证不迟到的前提下，每天尽可能晚地出门上学。但同学们并不会计算从家需要多久才能到学校，于是找到了聪明的小 A。第 $i$ 位同学 ($1 \\leq i \\leq q$) 告诉小 A，他的家位置于编号为 $h_i$ 的结点，并且他每秒钟能行走 1 米。请你帮小 A 计算，每位同学从家出发需要多少秒才能到达学校呢？`,
    inputFormat: `第一行，四个正整数 $n, m, s, q$，分别表示 C 城的结点数与边数，学校所在的结点编号，以及小 A 同学们的数量。

接下来 $m$ 行，每行三个正整数 $u_i, v_i, l_i$，表示 C 城中的一条无向边。

接下来 $q$ 行，每行一个正整数 $h_i$，表示一位同学的情况。`,
    outputFormat: `共 $q$ 行，对于每位同学，输出一个整数，表示从家出发到学校的最短时间。`,
    samples: [
      { input: `5 5 3 3\n1 2 3\n2 3 2\n3 4 1\n4 5 3\n1 4 2\n5\n1\n4`, output: `4\n3\n1` },
    ],
    testCases: [
      // 原始样例
      { input: `5 5 3 3\n1 2 3\n2 3 2\n3 4 1\n4 5 3\n1 4 2\n5\n1\n4`, output: `4\n3\n1` },
      // 边界：n=2, m=1, q=1
      { input: `2 1 1 1\n1 2 5\n2`, output: `5` },
      // 从学校出发
      { input: `3 2 2 1\n1 2 3\n2 3 4\n2`, output: `0` },
      // 线性图
      { input: `4 3 1 3\n1 2 1\n2 3 1\n3 4 1\n2\n3\n4`, output: `1\n2\n3` },
      // 完全图结构（稠密）
      { input: `4 6 1 3\n1 2 1\n1 3 2\n1 4 3\n2 3 1\n2 4 2\n3 4 1\n2\n3\n4`, output: `1\n2\n3` },
      // 大权值边
      { input: `3 2 1 2\n1 2 1000000\n2 3 1000000\n2\n3`, output: `1000000\n2000000` },
      // 多条路径选择最短
      { input: `4 4 1 2\n1 2 10\n2 3 10\n1 3 5\n3 4 1\n3\n4`, output: `5\n6` },
      // 星状图
      { input: `5 4 1 4\n1 2 1\n1 3 2\n1 4 3\n1 5 4\n2\n3\n4\n5`, output: `1\n2\n3\n4` },
      // 同一点多次查询
      { input: `3 2 1 3\n1 2 5\n2 3 3\n2\n2\n2`, output: `5\n5\n5` },
      // 复杂图
      { input: `5 6 3 3\n1 2 2\n2 3 1\n1 3 4\n3 4 2\n4 5 3\n2 5 10\n1\n5\n2`, output: `3\n5\n1` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `**本题采用捆绑测试。**

对于 $20\\%$ 的测试点，保证 $q = 1$。

对于另外 $20\\%$ 的测试点，保证 $1 \\leq n \\leq 500$，$1 \\leq m \\leq 500$。

对于所有测试点，保证 $1 \\leq n \\leq 2 \\times 10^5$，$1 \\leq m \\leq 2 \\times 10^5$，$1 \\leq q \\leq 2 \\times 10^5$，$1 \\leq u_i, v_i, s, h_i \\leq n$，$1 \\leq l_i \\leq 10^6$。`,
  },
  {
    title: "[GESP202503 八级] 割裂",
    source: "gesp_official",
    sourceId: "P11967",
    sourceUrl: "https://www.luogu.com.cn/problem/P11967",
    level: 8,
    knowledgePoints: ["树", "LCA", "路径交", "连通性"],
    difficulty: "普及+/提高",
    description: `小杨有一棵包含 $ n $ 个节点的树，其中节点的编号从 $ 1 $ 到 $ n $。

小杨设置了 $ a $ 个好点对 $\\{\\langle u_1, v_1 \\rangle, \\langle u_2, v_2 \\rangle, \\dots, \\langle u_a, v_a \\rangle\\}$ 和一个坏点对 $\\langle b_u, b_v \\rangle$。一个节点能被删除，当且仅当：

- 删除该节点后对于所有的 $ 1 \\leq i \\leq a $，好点对 $ u_i $ 和 $ v_i $ 仍然连通；
- 删除该节点后坏点对 $ b_u $ 和 $ b_v $ 不连通。

如果点对中的任意一个节点被删除，其视为不连通。

小杨想知道，还有多少个节点能被删除。`,
    inputFormat: `第一行包含两个非负整数 $ n $, $ a $，含义如下题面所示。

接下来 $n - 1$ 行，每行包含两个正整数 $ x_i, y_i $，代表存在一条连接节点 $ x_i $ 和 $ y_i $ 的边；

之后 $ a $ 行，每行包含两个正整数 $ u_i, v_i $，代表一个好点对 $ \\langle u_i, v_i \\rangle $；

最后一行包含两个正整数 $ b_u, b_v $，代表坏点对 $ \\langle b_u, b_v \\rangle $。`,
    outputFormat: `输出一个非负整数，代表删除的节点个数。`,
    samples: [
      { input: `6 2\n1 3\n1 5\n3 6\n3 2\n5 4\n5 4\n5 3\n2 6`, output: `2` },
    ],
    testCases: [
      // 原始样例
      { input: `6 2\n1 3\n1 5\n3 6\n3 2\n5 4\n5 4\n5 3\n2 6`, output: `2` },
      // 边界：n=2, a=0
      { input: `2 0\n1 2\n1 2`, output: `2` },
      // a=0，删除坏点路径上任意节点
      { input: `5 0\n1 2\n2 3\n3 4\n4 5\n1 5`, output: `5` },
      // 坏点对相邻
      { input: `3 0\n1 2\n2 3\n1 2`, output: `2` },
      // 好点对和坏点对相同
      { input: `3 1\n1 2\n2 3\n1 3\n1 3`, output: `0` },
      // 好点对覆盖坏点对路径
      { input: `5 1\n1 2\n2 3\n3 4\n4 5\n1 5\n1 5`, output: `0` },
      // 好点对和坏点对不相交
      { input: `6 1\n1 2\n2 3\n3 4\n4 5\n5 6\n1 2\n5 6`, output: `2` },
      // 多个好点对
      { input: `5 2\n1 2\n2 3\n2 4\n4 5\n1 3\n4 5\n1 5`, output: `0` },
      // 链状树
      { input: `4 1\n1 2\n2 3\n3 4\n1 2\n3 4`, output: `2` },
      // 星状树
      { input: `5 0\n1 2\n1 3\n1 4\n1 5\n2 3`, output: `3` },
      // 坏点对端点之一可删除
      { input: `4 0\n1 2\n2 3\n3 4\n2 4`, output: `3` },
    ],
    timeLimit: 4000,
    memoryLimit: 512,
    hint: `| 子任务编号 | 分值 | $ n $ | $ a $ |
|:-:|:-:|:-:|:-:|
| 1 | $20$ | $=10$ | $=0$ |
| 2 | $20$ | $ \\leq 100 $ | $ \\leq 100 $ |
| 3 | $60$ | $ \\leq 10^6 $ | $ \\leq 10^5 $ |

对于全部数据，保证有 $ 1 \\leq n \\leq 10^6 $, $ 0 \\leq a \\leq 10^5 $, $ u_i \\neq v_i $, $ b_u \\neq b_v $。`,
  },
  // ========== 2025年6月 ==========
  {
    title: "[GESP202506 八级] 树上旅行",
    source: "gesp_official",
    sourceId: "P13019",
    sourceUrl: "https://www.luogu.com.cn/problem/P13019",
    level: 8,
    knowledgePoints: ["树", "DFS", "树的遍历", "模拟"],
    difficulty: "普及+/提高",
    description: `给定一棵有 $ n $ 个结点的 **有根树**，结点依次以 $1,2,\\dots,n$ 编号，其中根结点的编号为 $1$。

小 A 计划在这棵有根树上进行 $q$ 次旅行。在第 $i$ 次旅行中，小 A 首先选定结点 $s_i$ 作为起点，并移动若干次。移动分为以下两种：

1. 移动至当前结点的父结点。特殊地，如果当前位于根结点，则不进行移动。
2. 移动至当前结点的所有子结点中**编号最小**的结点。特殊地，如果当前位于叶子结点，则不进行移动。

由于移动次数可能很大，对于第 $i$ 次旅行，旅行中的移动以 $k_i$ 个不为零的整数构成的序列 $a_{i,1}, a_{i,2}, \\dots, a_{i,k_i}$ 表示。对 $a_{i,j}$，若 $a_{i,j} > 0$ 则代表进行 $a_{i,j}$ 次第一种移动；若 $a_{i,j} < 0$ 则代表进行 $-a_{i,j}$ 次第二种移动。根据给出的序列从左至右完成所有移动后，小 A 所在的结点即是旅行的**终点**。

给定每次旅行的起点与移动序列，请你求出旅行终点的结点编号。`,
    inputFormat: `第一行，两个正整数 $n, q$，分别表示有根树的结点数量，以及旅行次数。

第二行，$n-1$ 个整数 $p_2, p_3, \\dots, p_n$，其中 $p_i$ 表示结点 $i$ 的父结点编号。

接下来 $2q$ 行中的第 $2i-1$ 行（$1 \\leq i \\leq q$）包含两个正整数 $s_i, k_i$，分别表示第 $i$ 次旅行的起点编号，以及移动序列的长度。第 $2i$ 行包含 $k_i$ 个整数 $a_{i,1}, a_{i,2}, \\dots, a_{i,k_i}$，表示移动序列。`,
    outputFormat: `输出共 $q$ 行，第 $i$ 行包含一个整数，表示第 $i$ 次旅行终点的结点编号。`,
    samples: [
      { input: `5 4\n1 1 2 2\n3 3\n1 -1 -1\n2 5\n1 -1 1 -1 1\n5 8\n1 1 1 -1 -1 -1 -1 -1\n5 3\n-1 -1 1`, output: `4\n1\n4\n2` },
      { input: `8 3\n5 4 2 1 3 6 6\n8 1\n8\n8 2\n8 -8\n8 3\n8 -8 8`, output: `1\n7\n1` },
    ],
    testCases: [
      // 原始样例
      { input: `5 4\n1 1 2 2\n3 3\n1 -1 -1\n2 5\n1 -1 1 -1 1\n5 8\n1 1 1 -1 -1 -1 -1 -1\n5 3\n-1 -1 1`, output: `4\n1\n4\n2` },
      { input: `8 3\n5 4 2 1 3 6 6\n8 1\n8\n8 2\n8 -8\n8 3\n8 -8 8`, output: `1\n7\n1` },
      // 边界：n=1，只有根节点
      { input: `1 2\n\n1 1\n1\n1 1\n-1`, output: `1\n1` },
      // 只向上移动
      { input: `4 2\n1 1 2\n4 1\n3\n3 1\n2`, output: `1\n1` },
      // 只向下移动
      { input: `4 2\n1 1 2\n1 1\n-2\n1 1\n-1`, output: `4\n2` },
      // 移动到根后继续向上（不动）
      { input: `3 1\n1 1\n2 1\n5`, output: `1` },
      // 移动到叶子后继续向下（不动）
      { input: `3 1\n1 1\n3 1\n-5`, output: `3` },
      // 链状树
      { input: `5 2\n1 2 3 4\n5 1\n4\n1 1\n-4`, output: `1\n5` },
      // 往返移动
      { input: `4 1\n1 2 2\n3 4\n1 -1 1 -1`, output: `3` },
      // 二叉树结构
      { input: `7 2\n1 1 2 2 3 3\n7 1\n3\n4 2\n1 -1`, output: `1\n4` },
      // 大步移动
      { input: `5 1\n1 2 3 4\n5 2\n-10 10`, output: `1` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `| 子任务编号 | 测试点占比 | $n$ | $q$ | $\\sum k_i$ | 特殊性质 |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $1$ | $20\\%$ | $\\leq 100$ | $\\leq 100$ | $\\leq 1000$ | 保证 $a_{i,j}$ 为 $1$ 或 $-1$ |
| $2$ | $20\\%$ | $\\leq 10^4$ | $\\leq 10^4$ | $\\leq 4 \\times 10^4$ | 仅包含第一种移动 |
| $3$ | $20\\%$ | $\\leq 10^4$ | $\\leq 10^4$ | $\\leq 4 \\times 10^4$ | 仅包含第二种移动 |
| $4$ | $40\\%$ | $\\leq 10^5$ | $\\leq 2 \\times 10^4$ | $\\leq 10^5$ | - |

对于所有测试点，保证：

- $1 \\leq n \\leq 10^5$
- $1 \\leq q \\leq 2 \\times 10^4$
- $1 \\leq p_i \\leq n$
- $1 \\leq s_i \\leq n$
- $k_i \\geq 1$ 且 $\\sum k_i \\leq 10^5$
- $1 \\leq |a_{i,j}| \\leq n$`,
  },
  {
    title: "[GESP202506 八级] 遍历计数",
    source: "gesp_official",
    sourceId: "P13020",
    sourceUrl: "https://www.luogu.com.cn/problem/P13020",
    level: 8,
    knowledgePoints: ["树", "DFS", "组合数学", "取模运算", "阶乘"],
    difficulty: "普及+/提高",
    description: `给定一棵有 $n$ 个结点的树 $T$，结点依次以 $1,2,\\dots,n$ 标号。树 $T$ 的深度优先遍历序可由以下过程得到：

1. 选定深度优先遍历的起点 $s$（$1 \\leq s \\leq n$），当前位置结点即是起点。
2. 若当前结点存在未被遍历的相邻结点 $u$ 则遍历 $u$，也即令当前位置结点为 $u$ 并重复这一步；否则回溯。
3. 按照遍历结点的顺序依次写下结点编号，即可得到一组深度优先遍历序。

第一步中起点的选择是任意的，并且第二步中遍历相邻结点的顺序也是任意的，因此对于同一棵树 $T$ 可能有多组不同的深度优先遍历序。请你求出树 $T$ 有多少组不同的深度优先遍历序。由于答案可能很大，你只需要求出答案对 $10^9$ 取模之后的结果。`,
    inputFormat: `第一行，一个整数 $n$，表示树 $T$ 的结点数。

接下来 $n-1$ 行，每行两个正整数 $u_i, v_i$，表示树 $T$ 中的一条连接结点 $u_i, v_i$ 的边。`,
    outputFormat: `输出一行，一个整数，表示树 $T$ 的不同的深度优先遍历序数量对 $10^9$ 取模的结果。`,
    samples: [
      { input: `4\n1 2\n2 3\n3 4`, output: `6` },
      { input: `8\n1 2\n1 3\n1 4\n2 5\n2 6\n3 7\n3 8`, output: `112` },
    ],
    testCases: [
      // 原始样例
      { input: `4\n1 2\n2 3\n3 4`, output: `6` },
      { input: `8\n1 2\n1 3\n1 4\n2 5\n2 6\n3 7\n3 8`, output: `112` },
      // 边界：n=1
      { input: `1`, output: `1` },
      // n=2
      { input: `2\n1 2`, output: `2` },
      // 链状树
      { input: `5\n1 2\n2 3\n3 4\n4 5`, output: `8` },
      // 星状树（中心度数大）
      { input: `5\n1 2\n1 3\n1 4\n1 5`, output: `48` },
      // 完全二叉树
      { input: `7\n1 2\n1 3\n2 4\n2 5\n3 6\n3 7`, output: `48` },
      // 三叉树
      { input: `4\n1 2\n1 3\n1 4`, output: `12` },
      // 不对称树
      { input: `6\n1 2\n2 3\n2 4\n1 5\n5 6`, output: `20` },
      // 复杂结构
      { input: `5\n1 2\n1 3\n2 4\n3 5`, output: `8` },
      // 长链
      { input: `6\n1 2\n2 3\n3 4\n4 5\n5 6`, output: `10` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `对于 $40\\%$ 的测试点，保证 $1 \\leq n \\leq 8$。

对于另外 $20\\%$ 的测试点，保证给定的树是一条链。

对于所有测试点，保证 $1 \\leq n \\leq 10^5$。

在洛谷上，只有通过了 Subtask0、Subtask1 和 Subtask2 后，才能获得第三个 Subtask 的分数。`,
  },
  // ========== 2025年9月 ==========
  {
    title: "[GESP202509 八级] 最短距离",
    source: "gesp_official",
    sourceId: "P14079",
    sourceUrl: "https://www.luogu.com.cn/problem/P14079",
    level: 8,
    knowledgePoints: ["图论", "数论", "最短路", "互质"],
    difficulty: "普及/提高-",
    description: `给定正整数 $p,q$ 以及常数 $N=10^{18}$。现在构建一张包含 $N$ 个结点的带权无向图，结点依次以 $1,2,\\ldots,N$ 编号。对于任意满足 $1\\le u<v\\le N$ 的 $u,v$，向图中加入一条连接结点 $u$ 与结点 $v$ 的无向边，边权取决于 $u,v$ 是否互质：

- 若 $u,v$ 互质（即 $u,v$ 的最大公因数为 $1$），则连接结点 $u$ 与结点 $v$ 的无向边长度为 $p$；
- 否则连接结点 $u$ 与结点 $v$ 的无向边长度为 $q$。

现在给定 $n$ 组询问，第 $i$（$1\\le i\\le n$）组询问给定两个正整数 $a_i,b_i$，你需要回答结点 $a_i$ 与结点 $b_i$ 之间的最短距离。`,
    inputFormat: `第一行，三个正整数 $n,p,q$，分别表示询问数量，结点编号互质时的边权，以及结点编号不互质时的边权。

接下来 $n$ 行，每行两个正整数 $a_i,b_i$，表示一组询问。`,
    outputFormat: `输出共 $n$ 行，每行一个整数，表示结点 $a_i$ 与结点 $b_i$ 之间的最短距离。`,
    samples: [
      { input: `4 4 3\n1 2\n2 3\n4 2\n3 5`, output: `4\n4\n3\n4` },
      { input: `5 2 6\n1 2\n2 3\n4 2\n3 5\n6 6`, output: `2\n2\n4\n2\n0` },
    ],
    testCases: [
      // 原始样例
      { input: `4 4 3\n1 2\n2 3\n4 2\n3 5`, output: `4\n4\n3\n4` },
      { input: `5 2 6\n1 2\n2 3\n4 2\n3 5\n6 6`, output: `2\n2\n4\n2\n0` },
      // 边界：同一节点
      { input: `1 1 1\n5 5`, output: `0` },
      // 相邻节点，互质
      { input: `1 3 5\n2 3`, output: `3` },
      // 相邻节点，不互质
      { input: `1 3 5\n4 6`, output: `5` },
      // 节点1与任意节点互质
      { input: `3 2 10\n1 100\n1 99\n1 1000000000`, output: `2\n2\n2` },
      // p < q，优先互质边
      { input: `2 1 100\n4 6\n9 15`, output: `2\n2` },
      // p > q，优先不互质边
      { input: `2 100 1\n4 6\n9 15`, output: `1\n1` },
      // 大数测试
      { input: `2 5 3\n1000000000 999999999\n123456789 987654321`, output: `5\n3` },
      // 通过中间节点更短
      { input: `2 10 1\n4 9\n8 27`, output: `2\n2` },
      // 直接不互质更短
      { input: `1 100 5\n6 9`, output: `5` },
      // 质数节点
      { input: `3 2 5\n7 11\n13 17\n23 29`, output: `2\n2\n2` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `对于 $30\\%$ 的测试点，保证 $1\\le n\\le 10$，$1\\le a_i,b_i\\le 50$。

对于另外 $30\\%$ 的测试点，保证 $1\\le a_i,b_i\\le 250$。

对于所有测试点，保证 $1\\le n\\le 10^4$，$1\\le a_i,b_i\\le 10^9$，$1\\le p,q\\le 10^9$。`,
  },
  {
    title: "[GESP202509 八级] 最小生成树",
    source: "gesp_official",
    sourceId: "P14080",
    sourceUrl: "https://www.luogu.com.cn/problem/P14080",
    level: 8,
    knowledgePoints: ["图论", "最小生成树", "Kruskal", "树上路径"],
    difficulty: "提高+/省选-",
    description: `给定一张包含 $n$ 个结点 $m$ 条边的带权连通无向图，结点依次以 $1,2,\\ldots,n$ 编号，第 $i$ 条边（$1\\le i\\le m$）连接结点 $u_i$ 与结点 $v_i$，边权为 $w_i$。

对于每条边，请你求出从图中移除该条边后，图的最小生成树中所有边的边权和。特别地，若移除某条边后图的最小生成树不存在，则输出 $-1$。`,
    inputFormat: `第一行，两个正整数 $n,m$，分别表示图的结点数与边数。

接下来 $m$ 行中的第 $i$ 行（$1\\le i\\le m$）包含三个正整数 $u_i,v_i,w_i$，表示图中连接结点 $u_i$ 与结点 $v_i$ 的边，边权为 $w_i$。`,
    outputFormat: `输出共 $m$ 行，第 $i$ 行（$1\\le i\\le m$）包含一个整数，表示移除第 $i$ 条边后，图的最小生成树中所有边的边权和。若移除第 $i$ 条边后图的最小生成树不存在，则输出 $−1$。`,
    samples: [
      { input: `5 5\n1 2 4\n2 3 3\n3 4 1\n2 5 2\n3 1 8`, output: `14\n15\n-1\n-1\n10` },
      { input: `6 10\n1 2 6\n2 3 3\n3 1 4\n3 4 5\n4 5 8\n5 6 2\n6 4 1\n3 2 4\n5 4 4\n3 3 6`, output: `15\n16\n17\n-1\n15\n17\n18\n15\n15\n15` },
    ],
    testCases: [
      // 原始样例
      { input: `5 5\n1 2 4\n2 3 3\n3 4 1\n2 5 2\n3 1 8`, output: `14\n15\n-1\n-1\n10` },
      { input: `6 10\n1 2 6\n2 3 3\n3 1 4\n3 4 5\n4 5 8\n5 6 2\n6 4 1\n3 2 4\n5 4 4\n3 3 6`, output: `15\n16\n17\n-1\n15\n17\n18\n15\n15\n15` },
      // 边界：最小图 n=2
      { input: `2 1\n1 2 5`, output: `-1` },
      // 树结构，删任意边都不连通
      { input: `3 2\n1 2 1\n2 3 2`, output: `-1\n-1` },
      // 有一条冗余边的树
      { input: `3 3\n1 2 1\n2 3 2\n1 3 4`, output: `6\n5\n3` },
      // 环形图
      { input: `4 4\n1 2 1\n2 3 2\n3 4 3\n4 1 4`, output: `9\n8\n7\n6` },
      // MST边被删除
      { input: `4 5\n1 2 1\n2 3 1\n3 4 1\n1 4 10\n2 4 5`, output: `12\n7\n7\n3\n3` },
      // 所有边权相同
      { input: `4 5\n1 2 1\n2 3 1\n3 4 1\n4 1 1\n2 4 1`, output: `3\n3\n3\n3\n3` },
      // 重边
      { input: `3 4\n1 2 1\n1 2 2\n2 3 3\n1 3 5`, output: `5\n4\n6\n4` },
      // 自环（应该忽略）
      { input: `3 4\n1 1 5\n1 2 1\n2 3 2\n1 3 4`, output: `3\n6\n5\n3` },
      // 大权值
      { input: `3 3\n1 2 1000000000\n2 3 1000000000\n1 3 1`, output: `1000000001\n1000000001\n2000000000` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `| 子任务编号 | 测试点占比 | $n$ | $m$| 特殊性质 |
|:--:|:--:|:--:|:--:|:--:|
| 1 | $20\\%$ | $\\le 50$ | $\\le 100$ | - |
| 2 | $30\\%$ | $\\le 10^5$ | $\\le 10^5$| $n=m$ |
| 3 | $30\\%$ | $\\le 500$ | $\\le 2\\times 10^4$ | - |
| 4 | $20\\%$ | $\\le 10^5$ | $\\le 10^5$| - |

对于所有测试点，保证 $1\\le n\\le 10^5$，$1\\le m\\le 10^5$，$1\\le u_i,v_i\\le n$，$1\\le w_i\\le 10^9$。`,
  },
  // ========== 2025年12月 ==========
  {
    title: "[GESP202512 八级] 猫和老鼠",
    source: "gesp_official",
    sourceId: "P14923",
    sourceUrl: "https://www.luogu.com.cn/problem/P14923",
    level: 8,
    knowledgePoints: ["图论", "最短路", "Dijkstra", "博弈"],
    difficulty: "普及+/提高",
    description: `猫和老鼠所在的庄园可以视为一张由 $n$ 个点和 $m$ 条带权无向边构成的连通图。结点依次以 $1,2,\\ldots,n$ 编号，结点 $i$（$1\\le i\\le n$）有价值为 $c_i$ 的奶酪。在 $m$ 条带权无向边中，第 $i$（$1\\le i\\le m$）条无向边连接结点 $u_i$ 与结点 $v_i$，边权 $w_i$ 表示猫和老鼠通过这条边所需的时间。

猫窝位于结点 $a$，老鼠洞位于结点 $b$。对于老鼠而言，结点 $u$ 是**安全的**当且仅当：

- 老鼠能规划一条从结点 $u$ 出发逃往老鼠洞的路径，使得对于路径上任意结点 $x$（包括结点 $u$ 与老鼠洞）都有：猫从猫窝出发到结点 $x$ 的最短时间**严格大于**老鼠从结点 $u$ **沿这条路径**前往结点 $x$ 所需的时间。

老鼠在拿取安全结点的奶酪时不存在被猫抓住的可能，但在拿取不是安全结点的奶酪时则不一定。为了确保万无一失，老鼠决定只拿取安全结点放置的奶酪。请你计算老鼠所能拿到的奶酪价值之和。`,
    inputFormat: `第一行，两个正整数 $n,m$，分别表示图的结点数与边数。

第二行，两个正整数 $a,b$，分别表示猫窝的结点编号，以及老鼠洞的结点编号。

第三行，$n$ 个正整数 $c_1,c_2,\\ldots,c_n$，表示各个结点的奶酪价值。

接下来 $m$ 行中的第 $i$ 行（$1\\le i\\le m$）包含三个正整数 $u_i,v_i,w_i$，表示图中连接结点 $u_i$ 与结点 $v_i$ 的边，边权为 $w_i$。`,
    outputFormat: `输出一行，一个整数，表示老鼠所能拿到的奶酪价值之和。`,
    samples: [
      { input: `5 5\n1 2\n1 2 4 8 16\n1 2 4\n2 3 3\n3 4 1\n2 5 2\n3 1 8`, output: `22` },
      { input: `6 10\n3 4\n1 1 1 1 1 1\n1 2 6\n2 3 3\n3 1 4\n3 4 5\n4 5 8\n5 6 2\n6 4 1\n3 2 4\n5 4 4\n3 3 6`, output: `3` },
    ],
    testCases: [
      // 原始样例
      { input: `5 5\n1 2\n1 2 4 8 16\n1 2 4\n2 3 3\n3 4 1\n2 5 2\n3 1 8`, output: `22` },
      { input: `6 10\n3 4\n1 1 1 1 1 1\n1 2 6\n2 3 3\n3 1 4\n3 4 5\n4 5 8\n5 6 2\n6 4 1\n3 2 4\n5 4 4\n3 3 6`, output: `3` },
      // 边界：n=2
      { input: `2 1\n1 2\n10 20\n1 2 5`, output: `20` },
      // 老鼠洞附近安全
      { input: `3 2\n1 3\n1 2 3\n1 2 10\n2 3 1`, output: `5` },
      // 猫和老鼠洞相邻
      { input: `3 2\n1 2\n5 10 15\n1 2 1\n2 3 100`, output: `10` },
      // 链状图
      { input: `4 3\n1 4\n1 2 3 4\n1 2 1\n2 3 1\n3 4 1`, output: `9` },
      // 星状图
      { input: `5 4\n1 5\n10 1 1 1 100\n1 2 1\n1 3 1\n1 4 1\n1 5 10`, output: `100` },
      // 所有节点都安全
      { input: `3 2\n3 1\n5 10 15\n1 2 100\n2 3 1`, output: `15` },
      // 只有老鼠洞安全
      { input: `3 2\n2 1\n100 5 100\n1 2 1\n2 3 100`, output: `100` },
      // 复杂图
      { input: `4 4\n1 4\n1 2 3 4\n1 2 2\n2 3 2\n3 4 2\n1 4 10`, output: `9` },
      // 大权值奶酪
      { input: `3 2\n1 3\n1000000000 1 1000000000\n1 2 1\n2 3 100`, output: `1000000001` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `对于 $40\\%$ 的测试点，保证 $1\\le n\\le 500$，$1\\le m\\le 500$。

对于所有测试点，保证 $1\\le n\\le 10^5$，$1\\le m\\le 10^5$，$1\\le a,b\\le n$ 且 $a\\neq b$，$1\\le u_i,v_i\\le n$，$1\\le w_i\\le 10^9$。

注：GESP 原题缺失 $c_i$ 范围，可按 $1 \\le c_i \\le 10^9$ 计算。`,
  },
  {
    title: "[GESP202512 八级] 宝石项链",
    source: "gesp_official",
    sourceId: "P14924",
    sourceUrl: "https://www.luogu.com.cn/problem/P14924",
    level: 8,
    knowledgePoints: ["双指针", "滑动窗口", "环形处理", "二分"],
    difficulty: "普及+/提高",
    description: `小 A 有一串包含 $n$ 枚宝石的宝石项链，这些宝石按照在项链中的顺序依次以 $1,2,\\ldots,n$ 编号，第 $n$ 枚宝石与第 $1$ 枚宝石相邻。项链由 $m$ 种宝石组成，其中第 $i$ 枚宝石种类为 $t_i$。

小 A 想将宝石项链分给他的好朋友们。具体而言，小 A 会将项链划分为若干**连续段**，并且需要保证每段都包含全部 $m$ 种宝石。请帮小 A 计算在满足条件的前提下，宝石项链最多可以划分为多少段。`,
    inputFormat: `第一行，两个正整数 $n,m$，分别表示宝石项链中的宝石的数量与种类数。

第二行，$n$ 个正整数 $t_1,t_2,\\ldots,t_n$，表示每枚宝石的种类。`,
    outputFormat: `输出一行，一个整数，表示宝石项链最多可以划分的段数。`,
    samples: [
      { input: `6 2\n1 2 1 2 1 2`, output: `3` },
      { input: `7 3\n3 1 3 1 2 1 2`, output: `2` },
    ],
    testCases: [
      // 原始样例
      { input: `6 2\n1 2 1 2 1 2`, output: `3` },
      { input: `7 3\n3 1 3 1 2 1 2`, output: `2` },
      // 边界：n=m=2
      { input: `2 2\n1 2`, output: `1` },
      // 每种只有一个
      { input: `3 3\n1 2 3`, output: `1` },
      // 只能分一段
      { input: `4 3\n1 2 3 1`, output: `1` },
      // 均匀分布
      { input: `8 2\n1 2 1 2 1 2 1 2`, output: `4` },
      // 某种宝石出现次数很少
      { input: `6 3\n1 1 2 1 1 3`, output: `1` },
      // 环形特性
      { input: `6 2\n1 1 2 2 1 2`, output: `3` },
      // 最优划分从中间开始
      { input: `8 2\n2 1 2 1 2 1 2 1`, output: `4` },
      // 三种宝石
      { input: `9 3\n1 2 3 1 2 3 1 2 3`, output: `3` },
      // 不均匀分布
      { input: `7 2\n1 1 1 2 1 1 2`, output: `2` },
      // 大量重复
      { input: `10 2\n1 1 1 1 2 1 1 1 1 2`, output: `2` },
    ],
    timeLimit: 1000,
    memoryLimit: 512,
    hint: `对于 $40\\%$ 的测试点，保证 $2\\le n\\le 1000$。

对于所有测试点，保证 $2\\le n\\le 10^5$，$2\\le m\\le n$，$1\\le t_i\\le m$，保证 $1,2,\\ldots,m$ 均在 $t_1,t_2,\\ldots,t_n$ 中出现。`,
  },
];

async function seedGesp8() {
  try {
    let addedCount = 0;
    let updatedCount = 0;

    for (const problem of gesp8Problems) {
      const existing = await prisma.problem.findFirst({
        where: { sourceId: problem.sourceId }
      });

      if (existing) {
        await prisma.problem.update({
          where: { id: existing.id },
          data: problem
        });
        updatedCount++;
      } else {
        await prisma.problem.create({
          data: problem
        });
        addedCount++;
      }
    }

    return NextResponse.json({
      success: true,
      message: `GESP 8级：新增 ${addedCount} 道，更新 ${updatedCount} 道`,
      addedCount,
      updatedCount,
      totalCount: gesp8Problems.length
    });
  } catch (error) {
    console.error("Seed GESP8 error:", error);
    return NextResponse.json({ error: "添加题目失败", details: String(error) }, { status: 500 });
  }
}

export async function GET() {
  return seedGesp8();
}

export async function POST() {
  return seedGesp8();
}
